SELECT
advertiser_id,
 advertiser_name advertiser_name_duplicate,
 package_id,
 line_item_id,
 ad_id,
  creative_id,
SUM(to_currency(cost,'aud',impression_date)) cost_aud,
impression_date,
 mobile_device_id,
 inventory_source_name,
 ad_format_id,
 creative_size,
  video_player_size,
 video_playback_method,
 tld,
 region_name,
 dma_name,
 postal_code,
 device_type,
mobile_device_type_id,
 os_type,
 os_version,
 browser_type_name,
 net_connection_speed,
country_name,
 format,
 environment,
 first_attribution_contract_id,
 second_attribution_contract_id,
 third_attribution_contract_id,
 deal_id,
 deal_name,
 deal_floor_price,
 contextual_concept_id,
 brand_safety_concept_id,
 brand_safety_data_cost,
 page_quality_concept_id,
cpc_cost,
case when SUM(click)>0 then SUM(click) else '0' end click,
click_datetime,
dynamic_pricing,
mobile_device_manufacturer_id,
device_manufacturer as mobile_device_model,
 mobile_device_os,
 mobile_device_os_version,
 ad_call_id,
 ad_position,
 auction_type,
 iab_category_id,
 user_id,
 first_attribution_data_cost,
 second_attribution_data_cost,
 third_attribution_data_cost,
 cogs,
 content_data_cost,
 data_cost,
sum(to_currency(data_cost,'AUD',impression_date))  data_cost_aud,
 cost,
 contextual_data_cost,
 page_quality_data_cost,
advertiser_name,
insertion_order_name,
package_name,
line_item_name,
creative_name,
 first_attribution_contract_name,
 first_attribution_provider_id,
 first_attribution_provider_name,
  second_attribution_contract_name,
 second_attribution_provider_id,
 second_attribution_provider_name,
 third_attribution_contract_name,
 third_attribution_provider_id,
 third_attribution_provider_name,
 contextual_category_id,
 contextual_category_name,
 contextual_contract_id,
 contextual_contract_name,
 contextual_provider_id,
 contextual_provider_name
FROM amobee_media 
 where market_id = 301 
 and date > '2022_09_04'
 and event_type in('impression')
 group by 
advertiser_id,
 advertiser_name_duplicate,
 package_id,
 line_item_id,
 ad_id,
  creative_id,
 impression_date,
 mobile_device_id,
 inventory_source_name,
 ad_format_id,
 creative_size,
  video_player_size,
 video_playback_method,
 tld,
 region_name,
 dma_name,
 postal_code,
 device_type,
mobile_device_type_id,
 os_type,
 os_version,
 browser_type_name,
 net_connection_speed,
country_name,
 format,
 environment,
 first_attribution_contract_id,
 second_attribution_contract_id,
 third_attribution_contract_id,
 deal_id,
 deal_name,
 deal_floor_price,
 contextual_concept_id,
 brand_safety_concept_id,
 brand_safety_data_cost,
 page_quality_concept_id,
cpc_cost,
click,
click_datetime,
dynamic_pricing,
mobile_device_manufacturer_id,
 mobile_device_model,
 mobile_device_os,
 mobile_device_os_version,
 ad_call_id,
 ad_position,
 auction_type,
 iab_category_id,
 user_id,
 first_attribution_data_cost,
 second_attribution_data_cost,
 third_attribution_data_cost,
 cogs,
 content_data_cost,
 data_cost,
 cost,
 contextual_data_cost,
 page_quality_data_cost,
advertiser_name,
insertion_order_name,
package_name,
line_item_name,
creative_name,
 first_attribution_contract_name,
 first_attribution_provider_id,
 first_attribution_provider_name,
  second_attribution_contract_name,
 second_attribution_provider_id,
 second_attribution_provider_name,
 third_attribution_contract_name,
 third_attribution_provider_id,
 third_attribution_provider_name,
 contextual_category_id,
 contextual_category_name,
 contextual_contract_id,
 contextual_contract_name,
 contextual_provider_id,
 contextual_provider_name
